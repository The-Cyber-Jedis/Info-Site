<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Student Org | Research</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../styles.css">
  <script src="../../.path"></script>
  <script>
    if (window.siteConfig?.pageTitles?.research) document.title = window.siteConfig.pageTitles.research;
  </script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <header>
    <h1>Research Teams</h1>
    <nav>
      <ul class="nav-links">
        <li><a href="../../index.html">Home</a></li>
        <li><a href="../../CONNECT/connect.html">Connect</a></li>
        <li><a href="../../MERCH/merch.html">Merch</a></li>
        <li class="dropdown">
          <a href="#">Teams</a>
          <ul class="dropdown-content">
            <li><a href="../EPISODE/episode.html">EPISODE</a></li>
            <li><a href="../ORDER404/order404.html">ORDER404</a></li>
            <li><a href="research.html">RESEARCH</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <h2>Research Posts</h2>
    <p style="max-width:800px; margin:0 auto 1.5rem; text-align:center;">ReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMeReplaceMe</p>
    <div class="filters">
      <strong>Filter by Group:</strong>
      <label><input type="checkbox" checked value="QPost" onchange="filterPosts()"> Quantum Cryptography (QPost)</label>
      <label><input type="checkbox" checked value="CWPost" onchange="filterPosts()"> Cyber Warfare (CWPost)</label>
    </div>
    <div id="posts-container" class="posts-grid"></div>

    <div id="post-modal" class="hidden">
      <div id="modal-content">
        <button onclick="document.getElementById('post-modal').classList.add('hidden')">Close [x]</button>
        <div id="modal-body"></div>
      </div>
    </div>
  </main>
  <footer>
    <p id="copyright">&copy; 2026 The UTSA Cyber Jedis</p>
  </footer>
  <script src="../../bg-effect.js"></script>
  <script src="../../site-data.js"></script>
  <script>
    async function filterPosts() {
      const container = document.getElementById('posts-container');
      const checkboxes = document.querySelectorAll('.filters input:checked');
      const activeGroups = Array.from(checkboxes).map(cb => cb.value);
      
      const allPosts = siteData.posts.research;
      
      // Sort: extract prefix and number
      // e.g. QPost_001.md -> prefix: QPost, number: 001
      function getOrder(file) {
        const match = file.match(/(\w+)_(\d+)\.md/);
        return match ? parseInt(match[2]) : 999;
      }
      function getPrefix(file) {
        const match = file.match(/(\w+)_(\d+)\.md/);
        return match ? match[1] : '';
      }

      const filtered = allPosts.filter(p => activeGroups.includes(getPrefix(p)));
      filtered.sort((a,b) => getOrder(a) - getOrder(b));

      container.innerHTML = '';
      for (const filePath of filtered) {
        const relPath = "../../" + filePath;
        const res = await fetch(relPath);
        const text = await res.text();
        const firstLine = text.split('\n')[0].replace('#','').trim();
        
        const card = document.createElement('div');
        card.className = 'post-card';
        card.innerHTML = `
          <span class="post-group-label">${getPrefix(filePath)}</span>
          <h3>${firstLine}</h3>
          <p>Update #${getOrder(filePath)}</p>
          <small>Click to read more...</small>
        `;
        card.onclick = () => {
          document.getElementById('modal-body').innerHTML = marked.parse(text);
          document.getElementById('post-modal').classList.remove('hidden');
        };
        container.appendChild(card);
      }
    }
    filterPosts();
  </script>
  <script>
    // Update dynamic content from config
    if (window.siteConfig) {
      const copyrightEl = document.getElementById('copyright');
      if (copyrightEl) copyrightEl.innerHTML = `&copy; ${window.siteConfig.copyrightYear} ${window.siteConfig.copyrightOwner}`;
    }
  </script>
</body>
</html>
